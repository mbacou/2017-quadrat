---
title: "SSA Agricultural Potential (Documentation)"
author: "[BACOU, Melanie](http://github.com/mbacou) for BMGF"
date: "Last updated on `r Sys.Date()`. DO NOT USE OR CITE"
description: "Spatial segmentation of sub-Saharan Africa's arable land into zones of low and high agricultural potential."
site: bookdown::bookdown_site
knit: bookdown::render_book
output:
  bookdown::gitbook:
    url: "https://mbacou.github.io/2017-quadrat/"
    github-repo: "mbacou/2017-quadrat"
df_print: paged
always_allow_html: yes
bibliography: biblio.bib
cover-image: fig/cover.jpg
csl: apa.csl
link-citations: yes
nocite: |
  @mathew2016drought, @santiago2016speibase, @hengl2017soilgrids, @zabel2014suitability
---

# Data Sources

Existing sources of hi-res spatial covariates to estimate regional agricultural potential (tested over Ghana and Nigeria).

```{r setup, include=F}

library(raster)
library(rasterVis)
library(data.table)
library(viridis)
library(knitr)
library(tmap)

load("../tmp/2017-quadrat.RData")

# Output options
opts_chunk$set(comment=NA, warning=F, message=F, echo=F, base.url="../docs",
  dev="png", fig.path="fig/", fig.width=4, fig.height=4, dpi=300, cache=F, 
  dev.args=list(
    png=list(family="Roboto Condensed", pointsize=9), 
    svg=list(family="Roboto Condensed")))

```


```{r gha, eval=FALSE}

library(raster)
library(data.table)
library(viridis)
library(stringr)
library(tmap)

setwd("~/Projects/2017-quadrat")
load("./tmp/2017-quadrat.RData")
rasterOptions(tmpdir="/home/projects/data/tmp", tmptime=24, progress="text", 
  timer=T, overwrite=T, chunksize=2e+08)

# We agreed to a quick but likely good enough approach. Dekadal NDVI data for 15-16 
# years and will extract the maximum value for each year and take the mean of that for
# each pixel and then we will take that file that will also have cropland mask and 
# forest/WDPA mask values to decide the exact algorithm to assign hi or lo ag. pot
# values

# Load the grid catalogs we created for AgResults
load("../2017-agresults/tmp/2017-agresults.RData")
# Clean stuff we don't need here
rm(list=setdiff(ls(), c("afsis", "fews", "bio.lbl", "pplot", "na2null",
  "pal.et", "pal.et_anom", "pal.ndvi", "pal.ndvi_anom", 
  "pal.ndvi_pct", "pal.orcdrc", "pal.pet",
  "pal.rain", "pal.rfe", "pal.spei", "pal.temp")))

# Map spatial covariates over Ghana
# Start with 2015-2016 period summaries
gha <- getData("GADM", country="GHA", level=1)
nga <- getData("GADM", country="NGA", level=1)
zoi <- rbind(gha, nga)

# Default map options
# tm_scale_bar(position=c("right", "bottom"), breaks=c(0,50,100,150)) +
p <- tm_layout(legend.outside=T, legend.text.size=.8, attr.outside=T, title.size=.8)


##################################################################################### 
# Land cover (ESA/CCI, 2015)
tmp <- raster("~/Projects/hc-data/ESA/ESACCI-LC-L4-LCCS-Map-300m-P1Y-2015-v2.0.7.tif")
res(tmp)
# [1] 0.002777778 0.002777778
tmp <- crop(tmp, gha)
tmp[tmp==0] <- NA
hist(tmp)

pal.lc <- fread("~/Projects/hc-data/ESA/ESACCI-LC-Legend.csv")
setnames(pal.lc, 1:2, c("code", "class"))
pal.lc[, col := rgb(cbind(R,G,B), maxColorValue=255)]
pal.lc[, cat := str_replace_all(str_replace_all(abbreviate(toupper(class), 5), fixed("("), ""), fixed("/"), "")]

m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.lc$col,
  title="ESA/CCI Land Cover\n2015, 300m",
  breaks=c(pal.lc$code, 255), labels=pal.lc$cat) + p

save_tmap(m, "./docs/out/esa-lc.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)


##################################################################################### 
# AGRHYMET - hi-res land cover (USGS/EROS, 2013)
tmp <- raster("~/Projects/hc-data/FEWS/west_africa_land-use_land-cover_2013_2km/swa_2013lulc_2km.tif")
proj4string(tmp)
# [1] "+proj=laea +lat_0=11 +lon_0=3 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs +ellps=WGS84 +towgs84=0,0,0"
res(tmp)
# [1] 2000 2000 => 2km

gha <- spTransform(gha, proj4string(tmp))
tmp <- crop(tmp, gha)
gha <- spTransform(gha, CRS("+init=epsg:4326"))
unique(tmp)
#  [1]  1  2  3  4  6  7  8  9 10 11 12 13 14 15 21 22 23 24 25 27 31 78
levels(tmp)

pal.walc <- data.table(levels(tmp)[[1]])
pal.walc [, col := rgb(cbind(red,green,blue), maxColorValue=255)]
pal.walc[, code := as.character(code)]
setkey(pal.walc, value)
levels(tmp) <- pal.walc[, .(ID=value, code, class=class_name, col)]

m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.walc$col,
  title="USGS/EROS\nWest Africa LULC\n2013, 2km",
  breaks=c(pal.walc$value, 255), labels=pal.walc$code) + p

save_tmap(m, "./docs/out/usgs-lc.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)


#####################################################################################
# CHIRPS
gdalUtils::gdalinfo(fews[varCode=="chirps" & status==T, last(raster)])
# => no NA value is defined, EPSG:4326
tmp <- stack(as.list(fews[varCode=="chirps" & date %between% c("2015-01-01", "2016-12-31"), raster]))
tmp <- crop(tmp, gha)
minValue(tmp[[1]])
# [1] -9999
maxValue(tmp[[1]])
# [1] 28.92094
tmp[tmp<0] <- NA

# 2015-2016 period summary
tmp.mean <- (sum(tmp[[1:12]], na.rm=T)+sum(tmp[[13:24]], na.rm=T))/2
minValue(tmp.mean)
# [1] 0
maxValue(tmp.mean)
# [1] 2094.527

m <- tm_shape(tmp.mean) + tm_raster(names(tmp.mean), pal=pal.rain(255),
  title="2-Year Mean\nYearly Rainfall\nCHIRPS v2.0\n2015/01-2016/12\n(mm)",
  breaks=seq(0,1900,100), labels=na2null(seq(0,1800,100)*c(1, NA))) + p

save_tmap(m, "./docs/out/fews-chirps.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

#####################################################################################
# RFE
gdalUtils::gdalinfo(fews[varCode=="rfe" & status==T, last(raster)])
tmp <- stack(as.list(fews[varCode=="rfe" & date %between% c("2015-01-01", "2016-12-31"), raster]))
proj4string(tmp) <- fews[varCode=="rfe" & status==T, last(proj)]
gha <- spTransform(gha, proj4string(tmp))
tmp <- crop(tmp, gha)
spplot(tmp[[2]])
colortable(tmp) <- logical(0)
minValue(tmp)
maxValue(tmp)

# 2015-2016 period summary
tmp.mean <- (sum(tmp[[1:36]], na.rm=T)+sum(tmp[[37:72]], na.rm=T))/2
minValue(tmp.mean)
# [1] 800
maxValue(tmp.mean)
# [1] 1790

m <- tm_shape(mask(tmp.mean, gha)) + tm_raster(names(tmp.mean), pal=pal.rain(255),
  title="2-Year Mean\nYearly RFE\n2015/01-2016/12\n(mm)",
  breaks=seq(0,1900,100), labels=na2null(seq(0,1800,100)*c(1, NA))) + p

gha <- spTransform(gha, CRS("+init=epsg:4326"))

save_tmap(m, "./docs/out/fews-rfe.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

#####################################################################################
# FEWS PET
tmp <- fews[varCode=="pet" & status==T, raster(last(raster), crs=last(proj))]
tmp[tmp<0] <- NA
minValue(crop(tmp, pts))
maxValue(crop(tmp, pts))
m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.pet(255),
  title="PET\nJune, 20 2017\n(mm)",
  breaks=seq(100,960,40), labels=na2null(seq(100,920,40)*c(1, NA))) + p

save_tmap(m, "./docs/out/fews-pet.png", width=6, height=3.6)

#####################################################################################
# FEWS ETa
tmp <- fews[varCode=="eta" & status==T, raster(last(raster), crs=last(proj))]
tmp[tmp<0] <- NA
maxValue(crop(tmp, pts))
m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.et(255),
  title="ETa\nJune 2017\ndekad 2\n(mm)",
  breaks=seq(0,130,10), labels=na2null(seq(0,120,10)*c(1, NA))) + p

save_tmap(m, "./docs/out/fews-eta.png", width=6, height=3.6)

#####################################################################################
# FEWS ET_ANOM - should be percent of median 1-100
# The anomalies are the ratio of ETa and median ETa, expressed as a percent value
#  ET product is still more reliable in a relative sense as in anomalies for drought
# monitoring purposes
tmp <- fews[varCode=="et_anom" & status==T, raster(last(raster), crs=last(proj))]
colortable(tmp) <- logical(0)
maxValue(crop(tmp, pts))
m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.et_anom(255),
  title="ET Anomaly\nJune 2017\ndekad 2\n(percent)",
  breaks=seq(0,285,15), labels=na2null(seq(0,270,15)*c(1, NA))) + p

save_tmap(m, "./docs/out/fews-et_anom.png", width=6, height=3.6)


#####################################################################################
# WorldGrids ETMNTS3 - Long-term MODIS-estimated Evapotranspiration (MOD16, mm)
# http://worldgrids.org/doku.php/wiki:etmnts3
# Should be based on MODIS `NBAR_EVI_Area`, the sum of fitted daily NBARA EVI values
# during the identified vegetation cycle (i.e. `Onset_Greenness_Increase` to
# `Onset_Greenness_Minimum`)
tmp <- raster("~/Projects/hc-data/WorldGrids/etmnts3a.tif")
res(tmp)
# [1] 0.008333333 0.008333333 => 1km
crs(tmp)
# +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
tmp <- crop(tmp, gha)
minValue(tmp)
# [1] 3516
maxValue(tmp)
# 17583

m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.et(255),
  title="Long-term\nMODIS ET\n(MOD16)\n(mm)",
  breaks=seq(0,19000,1000), labels=na2null(seq(0,18000,1000)*c(1, NA))) + p

save_tmap(m, "./docs/out/modis-et.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

#####################################################################################
# WorldGrids L14IGB3 - Cropland/natural vegetation mosaic based on the MOD12Q1 product
# http://worldgrids.org/doku.php/wiki:l14igb3 (2011, percent, 1km)
tmp <- raster("~/Projects/hc-data/WorldGrids/l14igb3a.tif")
res(tmp)
# [1] 0.008333333 0.008333333 => 1km
crs(tmp)
# +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0
NAvalue(tmp)
# [1] -Inf
minValue(tmp)
# [1] 0
maxValue(tmp)
# 255
hist(tmp)
tmp[tmp>100] <- NA

m <- tm_shape(crop(tmp, gha)) + tm_raster(names(tmp), pal=c("#ffffff", pal.ndvi_anom(255)),
  title="Cropland\nbased on the MODIS\nMOD12Q1 product\n(percent)",
  breaks=seq(0,105,5), labels=na2null(seq(0,100,5)*c(1, NA))) + p

save_tmap(m, "./docs/out/modis-cropland.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

#####################################################################################
# FEWS NDVI_ANOM
# Percent of Normal
# The absolute difference and anomaly images are stretched from - 0.3 to 0.3 NDVI. The
# area of relatively no difference is approximately -0.05 - 0.05.
# The percent of normal data are expressed as a percent, where values between 95 and
# 105 indicate average conditions. Values below 95 represent below average vegetation 
# conditions, while those above 105 represent above average conditions.
tmp <- fews[varCode=="ndvi_anom_east" & status==T, raster(last(raster), crs=last(proj))]
tmp1 <- fews[varCode=="ndvi_anom_west" & status==T, raster(last(raster), crs=last(proj))]
colortable(tmp) <- logical(0)
colortable(tmp1) <- logical(0)
tmp <- crop(tmp, ken.l2)
tmp1 <- crop(tmp1, nga.l2)
minValue(tmp)
maxValue(tmp)
minValue(tmp1)
maxValue(tmp1)
# => 0-255, 100 should be normal
spplot(tmp, col.regions=pal.ndvi_pct)

m <- tm_shape(tmp) + tm_raster(names(tmp), pal=pal.ndvi_pct(255),
  title="NDVI Anomaly\nJune 2017\ndekad 2\n(percent of normal)",
  breaks=seq(0,210,10), labels=na2null(seq(0,200,10)*c(1, NA))) +
  tm_shape(tmp1) + tm_raster(names(tmp1), pal=pal.ndvi_pct(255),
    legend.show=F, breaks=seq(0,210,10)) + p

save_tmap(m, "./docs/out/fews-ndvi_anom.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

```

```{r ndvi, eval=FALSE}

#####################################################################################
# FEWS NDVI
# eMODIS NDVI data are stretched (mapped) linearly (to byte values) as follows:
# [-1.0, 1.0] -> [0, 200] - Invalid Values: 201 - 255 
# NDVI = (value - 100) / 100 
# Seems to me all zero values are clouds (white legend), so should be NA too
# We need to download 2005-2015 10-year period, so let's add these grids into the 
# catalog `fews`
ndvi_west = list(
  varCode = "ndvi_west",
  varLabel = "eMODIS TERRA smoothed normalized difference vegetation index (NDVI) (dekadal, 0-1)",
  time = "dekad",
  unit = "index -1,1",
  files = paste0("wa", levels(interaction(str_pad(5:14, 2, "left", 0), str_pad(1:36, 2, "left", 0), sep="", lex.order=T)), ".zip"),
  url = "https://edcintl.cr.usgs.gov/downloads/sciweb1/shared/fews/web/africa/west/dekadal/emodis/ndvi_c6/temporallysmoothedndvi/downloads/dekadal/"
)

ndvi_west <- as.data.table(ndvi_west)
# Download all these files
# Fill in spatial resolution and projection details
dir <- "/home/projects/hc-data/FEWS/"
ndvi_west[, dest := paste0(dir, varCode, "/", files)]
download.file(paste0(ndvi_west$url, ndvi_west$files), ndvi_west$dest)
ndvi_west[, status := file.exists(dest)]
tmp <- ndvi_west[status=="FALSE"]

# Fill in approx dekadal dates
ndvi_west[time=="dekad", 
  date := rep(seq(as.Date("2005-01-01"), as.Date("2014-12-31"), "month"), each=3)+c(0,10,20), by=varCode]

# Unzip
tmp <- lapply(ndvi_west[status==T, dest], function(x) unzip(x, exdir=dirname(x)))
ndvi_west[status==T, raster := sapply(tmp, function(x) x[1])]

tmp <- raster(ndvi_west[1, raster])
ndvi_west[, `:=`(proj=proj4string(tmp), res=res(tmp)[1])]

# Append these new grids into `fews` catalog
fews <- rbind(fews, ndvi_west, fill=T)
rm(ndvi_west)

##########################################
# Method 1) Generate long-term mean of yearly maximum dekadal values
# Use stack() instead of brick() -- faster with clusterR()
fun <- function(x) {
  x[x > 200] <- NA
  max((x-100), na.rm=T) 
  # Keep values as INT2S *100 to save disk space
}

for (i in (2005:2014)[3:10]) {
  tmp <- stack(as.list(fews[varCode=="ndvi_west" & year(date)==i, raster]))
  showTmpFiles()
  removeTmpFiles(h=0)
  tmp <- crop(tmp, zoi)
  cat(i, "\n")
  # Return yearly max value
  out <- calc(tmp, fun, 
    filename=paste0(dir, "ndvi_west/wa", i, "_max.tif"),
    datatype="INT2S", overwrite=T)
}

# Load all yearly max rasters and take the 10-year mean
tmp <- stack(as.list(paste0(dir, "ndvi_west/wa", 2005:2014, "_max.tif")))
out <- calc(tmp, mean, na.rm=T, 
  filename=paste0(dir, "ndvi_west/wa2005-2014_mean.tif"), overwrite=T)

spplot(crop(out, gha)/100, col.regions=pal.ndvi(255),
  xlab="Long-term eMODIS C6 NDVI 2005-2015\n(mean of yearly dekadal maximums)")
# => all max values tend to remove variability, not sure that'd work for our purpose

# Plot GHA and NGA
out <- raster(paste0(dir, "ndvi_west/wa2005-2014_mean.tif"))
m <- tm_shape(crop(out, gha)) + tm_raster(names(out), pal=pal.ndvi(255),
  title="Long-Term eMODIS C6 NDVI\n2005-2015\nmean of yearly dekadal max\n(-1,1 index)",
  breaks=seq(-20,95,5), labels=na2null(seq(-20,90,5)/100*c(1, NA)),
  legend.hist=T) + p +
  tm_layout(legend.hist.width=1, legend.hist.height=1, legend.hist.size=.5)

save_tmap(m, "./docs/out/fews-ndvi_gha.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

m <- tm_shape(crop(out, nga)) + tm_raster(names(out), pal=pal.ndvi(255),
  title="Long-Term eMODIS C6 NDVI\n2005-2015\nmean of yearly dekadal max\n(-1,1 index)",
  breaks=seq(-20,95,5), labels=na2null(seq(-20,90,5)/100*c(1, NA)),
  legend.hist=T) + p +
  tm_layout(legend.hist.width=1, legend.hist.height=1, legend.hist.size=.5)

save_tmap(m, "./docs/out/fews-ndvi_nga.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

##########################################
# Method 2) Generate long-term mean counts of dekads below 0.3 (and 0.4)
# Keep values as INT2S *100 to save disk space
fun <- function(x) {
  x[x > 200] <- NA
  sum((x-100) <= 30, na.rm=T) 
}

for (i in (2005:2014)[2:10]) {
  tmp <- stack(as.list(fews[varCode=="ndvi_west" & year(date)==i, raster]))
  showTmpFiles()
  removeTmpFiles(h=0)
  cat(i, "\n")
  # Yearly count -- 114+307 sec
  out <- calc(crop(tmp, zoi), fun, 
    filename=paste0(dir, "ndvi_west/wa", i, "_ndvi30.tif"),
    datatype="INT2S", overwrite=T)
}

# Load all count rasters and take the 10-year mean
# Mask out all yearly rasters first
m <- raster(paste0(dir, "ndvi_west/wa0501.tif"))
for (i in 2006:2014) {
  tmp <- raster(paste0(dir, "ndvi_west/wa", i, "_ndvi30.tif"))
  mask(tmp, crop(m, zoi), filename=paste0(dir, "ndvi_west/wa", i, "_ndvi30.tif"), overwrite=T)
}

tmp <- stack(as.list(paste0(dir, "ndvi_west/wa", 2005:2014, "_ndvi30.tif")))
out <- calc(tmp, mean, na.rm=T, 
  filename=paste0(dir, "ndvi_west/wa2005-2014_ndvi30_mean.tif"), overwrite=T)
spplot(crop(out, gha), col.regions=rev(pal.ndvi(255)))

# Generate time-series
stats.xtra <- lapply(2005:2014[1], function(x) {
  tmp <- stack(as.list(fews[varCode=="ndvi_west" & year(date)==x, raster]))
  out <- as.data.table(t(summary(tmp)))
  out[, stdev := cellStats(tmp, sd, na.rm=T)]
  out[, dekad := 1:36]
})
stats.xtra <- rbindlist(stats.xtra, idcol=T)
setnames(stats.xtra, c("year", "stdev"))
stats.xtra[, date := as.Date(paste0(year, "-", rep(1:12, each=3), "-", rep(c(1,11,21), 12)))]

# Plot time-series
xyplot(min+q25+median+q75+max~date, stats.xtra,
  ylab="Dekads (1,36)", xlab="Long-Term NDVI 2005-2015 (West Africa)",
  panel=function(x, y, ...) {
    panel.grid(h=-1, v=0, lty=2)
    panel.xyplot(x, y, ..., type="l", col=viridis(5), lwd=1)
    panel.abline(h=stats[, mean(median)], col="grey30")
  },
  key=list(text=list(c("Max.", "Min.", "Median")),
    col=viridis(5), lty=c(1,1,1), lines=T, columns=3),
)

# Plot GHA and NGA
out <- raster(paste0(dir, "ndvi_west/wa2005-2014_ndvi30_mean.tif"))
m <- tm_shape(crop(out, gha)) + tm_raster(names(out), pal=rev(pal.ndvi(255)),
  title="Long-Term eMODIS C6 NDVI\n2005-2015\nmean yearly count\nof dekads\nbelow 0.3",
  breaks=seq(0,37,1), labels=na2null(seq(0,36,1)*c(1, NA)),
  legend.hist=T) + p +
  tm_layout(legend.hist.width=1, legend.hist.height=1, legend.hist.size=.5) 

save_tmap(m, "./docs/out/fews-ndvi30_gha.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

m <- tm_shape(crop(out, nga)) + tm_raster(names(out), pal=rev(pal.ndvi(255)),
  title="Long-Term eMODIS C6 NDVI\n2005-2015\nmean yearly count\nof dekads\nbelow 0.3",
  breaks=seq(0,37,1), labels=na2null(seq(0,36,1)*c(1, NA)),
  legend.hist=T) + p +
  tm_layout(legend.hist.width=1, legend.hist.height=1, legend.hist.size=.5)

save_tmap(m, "./docs/out/fews-ndvi30_nga.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)

#####################################################################################
# TODO ESA MERIS NDVI
# The NDVI product describes globally the yearly reference dynamic of the vegetation 
# greenness characterizing the 1999-2012 period. It is derived from 1km 
# SPOT-VEGETATION (VGT) data. AggMean smoothed NDVI values corresponding to the mean 
# NDVI over the 1999-2012 period. It gives the yearly reference dynamic of the 
# vegetation greenness at a 7-day frequency. 
# http://maps.elie.ucl.ac.be/CCI/viewer/download.php



```

```{r suit, eval=FALSE}

# GLUES Crop Suitability Data (percent, 1981-2010)
# http://geoportal-glues.ufz.de/

tmp <- raster("~/Projects/hc-data/GLUES/overall_cropsuit_i_1981-2010.tif")
res(tmp)
# [1] 0.008333333 0.008333333 => 1km
crs(tmp)
# +proj=longlat +datum=WGS84 +no_defs +ellps=WGS84 +towgs84=0,0,0 
maxValue(tmp)
# [1] 97
minValue(tmp)
# [1] 0
NAvalue(tmp)
# [1] -Inf

m <- tm_shape(crop(tmp, gha)) + tm_raster(names(tmp), pal=c("#ffffff", pal.ndvi(255)),
  title="GLUES\nCrop Suitability\n(all crops)\n(percent)",
  breaks=seq(0,105,5), labels=na2null(seq(0,100,5)*c(1, NA))) + p

save_tmap(m, "./docs/out/glues-suit.png", width=4, height=4, units="in", family="Roboto Condensed", pointsize=9)


```

```{r cpmask, eval=FALSE}

# 1a) Reclassify ESA LULC grid between no/lo/hi crop suitability
# 1b) Else use MODIS mosaic cropland (mask out pixels with 0 probability)
# 2) Mask out protected areas (rasterize WDPA shapefile)
# 3) Study the distribution of NDVI values across suitability classes


```


```{r save, eval=FALSE}

rm(tmp, tmp.mean, tmp1, m, out, i, x)
save.image(file="./tmp/2017-quadrat.RData")

```

```{r, out.width="390px"}

include_graphics(c(
  "./out/esa-lc.png",
  "./out/usgs-lc.png",
  "./out/fews-chirps.png",
  "./out/fews-rfe.png",
  "./out/modis-cropland.png",
  "./out/glues-suit.png"
  ))

```

Dekadal eMODIS C6 NDVI grids are summarized over a 10-year period (2005-2015) using the long-term mean of yearly maxima of dekadal values.

```{r, out.width="390px"}

include_graphics(c(
  "./out/fews-ndvi_gha.png",
  "./out/fews-ndvi_nga.png"))

```

Dekadal eMODIS C6 NDVI grids are summarized over a 10-year period (2005-2015) using the long-term mean yearly counts of dekads with NDVI below 0.3.

```{r, out.width="390px"}

include_graphics(c(
  "./out/fews-ndvi30_gha.png",
  "./out/fews-ndvi30_nga.png"))

```

# References

